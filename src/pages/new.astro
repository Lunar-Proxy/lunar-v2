---
import '@/main.css';
import Bookmark from '../layouts/bm.astro';
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content={Astro.generator} />
    <title>New Tab</title>
    <script src="@scripts/script.ts"></script>
  </head>
  <body class="h-screen flex items-center justify-center flex-col relative">
    <h1 class="text-7xl text-text-HEADER font-linux font-bold" id="clock"></h1>
    <p id="date" class="text-xl text-text-SECONDARY font-mono mt-2"></p>
    <p
      id="weather"
      class="absolute top-4 right-4 text-text-SECONDARY font-linux px-6 py-3 rounded-xl text-[16px] font-bold"
    >
    </p>
    <Bookmark />
  </body>
  <script>
    function Clock() {
      const now = new Date();
      const clockElement = document.getElementById('clock');
      if (clockElement) {
        clockElement.innerText = now.toLocaleTimeString([], { hour12: false });
      }
    }
  
    async function DisplayInfo() {
      const todayDate = new Date();
      const dateElement = document.getElementById('date');
      if (dateElement) {
        dateElement.innerText = todayDate.toLocaleDateString([], {
          weekday: 'long',
          month: 'long',
          day: 'numeric',
          year: 'numeric',
        });
      }
      try {
        const ipRes = await fetch('https://ipapi.co/json/');
        const ipData = await ipRes.json();
        const { latitude, longitude } = ipData;
    
        if (!latitude || !longitude) {
          throw new Error('Could not determine location');
        }
  
        const weatherRes = await fetch(`https://api.weather.gov/points/${latitude},${longitude}`);
        const pointData = await weatherRes.json();
  
        const forecastUrl = pointData.properties.forecast;
        // realistically should NEVER happen
        if (!forecastUrl) throw new Error('No forecast URL found for location.');
  
        const forecastRes = await fetch(forecastUrl);
        const forecastData = await forecastRes.json();
  
        const currentForecast = forecastData.properties.periods[0];
        const weatherElement = document.getElementById('weather');
        if (currentForecast && weatherElement) {
          weatherElement.innerText =
            `${currentForecast.shortForecast}, ${currentForecast.temperature}Â°${currentForecast.temperatureUnit}`;
        } else if (weatherElement) {
          weatherElement.innerText = 'Weather unavailable';
        }
      } catch (error) {
        console.error('error fetching weather:', error);
        const weatherElement = document.getElementById('weather');
        if (weatherElement) {
          weatherElement.innerText = 'Weather unavailable';
        }
      }
    }
  
    DisplayInfo();
    Clock();
    setInterval(Clock, 1000);
  </script>  
</html>
