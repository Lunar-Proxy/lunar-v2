---
import '@/main.css';
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content={Astro.generator} />
    <title>New Tab</title>
  </head>
  <body class="h-screen flex items-center justify-center flex-col relative">
    <h1 class="text-7xl text-text-HEADER font-linux font-bold" id="clock"></h1>
    <p id="date" class="text-xl text-text-SECONDARY font-mono mt-2"></p>
    <p
      id="weather"
      class="absolute top-4 right-4 text-text-SECONDARY font-linux px-6 py-3 rounded-xl text-[16px] font-bold"
    ></p>
  </body>

  <script>
    async function displayWeather() {
      try {
        const locationRes = await fetch('https://ipapi.co/json/');
        const locationData = await locationRes.json();
        const lat = locationData.latitude;
        const lon = locationData.longitude;

        const weatherRes = await fetch(
          `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=imperial&appid=735b6d179fce1fdfad4f7d5044c81121`
        );
        const weatherData = await weatherRes.json();

        const rawDescription = weatherData.weather[0].description;
        const description = rawDescription
          .split(' ')
          .map((word: string) => word.charAt(0).toUpperCase() + word.slice(1))
          .join(' ');

        if (weatherData.main) {
          document.getElementById('weather')!.innerText = `${description}, ${Math.round(weatherData.main.temp)}Â°F`;
        }
      } catch (error) {
        console.error('[ERROR] Failed to fetch weather:', error);
      }
    }

    function displayInfo() {
      const now = new Date();
      document.getElementById('clock')!.innerText = now.toLocaleTimeString([], { hour12: false });
      const date = document.getElementById('date');
      if (date) {
        date.innerText = now.toLocaleDateString([], {
          weekday: 'long',
          month: 'long',
          day: 'numeric',
          year: 'numeric',
        });
      }
    }

    setInterval(displayInfo, 1000);
    displayInfo();
    displayWeather();
  </script>
</html>
