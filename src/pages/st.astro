---
import '@/main.css';
import ImportLucide from '../layouts/lucide.astro';
---

<html lang="en">
  <head>
    <title>Settings</title>
    <style>
      .toggle {
        width: 40px;
        height: 22px;
        background: var(--background-overlay);
        border-radius: 11px;
        cursor: pointer;
        position: relative;
        border: 1px solid rgba(255,255,255,0.08);
      }
      .toggle::after {
        content: '';
        position: absolute;
        top: 2px;
        left: 2px;
        width: 16px;
        height: 16px;
        background: var(--text-secondary);
        border-radius: 50%;
        transition: 0.15s;
      }
      .toggle.active {
        background: #6366f1;
        border-color: #6366f1;
      }
      .toggle.active::after {
        left: 20px;
        background: #fff;
      }
      .toast {
        animation: toast 0.2s ease;
      }
      @keyframes toast {
        from { opacity: 0; transform: translateY(6px); }
        to { opacity: 1; transform: translateY(0); }
      }
    </style>
  </head>

  <body class="bg-background font-linux text-text-header min-h-screen p-6 md:p-8">
    <div class="mx-auto max-w-5xl">
      <header class="mb-8">
        <h1 class="text-2xl font-bold mb-1">Settings</h1>
        <p class="text-text-secondary text-sm">Customize Lunar</p>
      </header>

      <div class="flex gap-8">
        <nav class="hidden lg:block w-48 shrink-0">
          <div class="sticky top-6 space-y-1">
            <a href="#privacy" class="nav-item flex items-center gap-2.5 px-3 py-2 rounded-lg text-sm text-[#6366f1] bg-[#6366f1]/10" data-nav="privacy">
              <i data-lucide="shield" class="w-4 h-4"></i>Privacy
            </a>
            <a href="#browsing" class="nav-item flex items-center gap-2.5 px-3 py-2 rounded-lg text-sm text-text-secondary hover:text-text-header hover:bg-white/5" data-nav="browsing">
              <i data-lucide="globe" class="w-4 h-4"></i>Browsing
            </a>
            <a href="#advanced" class="nav-item flex items-center gap-2.5 px-3 py-2 rounded-lg text-sm text-text-secondary hover:text-text-header hover:bg-white/5" data-nav="advanced">
              <i data-lucide="wrench" class="w-4 h-4"></i>Advanced
            </a>
            <a href="#about" class="nav-item flex items-center gap-2.5 px-3 py-2 rounded-lg text-sm text-text-secondary hover:text-text-header hover:bg-white/5" data-nav="about">
              <i data-lucide="info" class="w-4 h-4"></i>About
            </a>
          </div>
        </nav>

        <main class="flex-1 space-y-10">
          <section id="privacy" data-section="privacy">
            <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
              <i data-lucide="shield" class="w-5 h-5 text-[#6366f1]"></i>
              Privacy & Cloaking
            </h2>
            
            <div class="space-y-3">
              <div class="bg-background-overlay/60 rounded-xl p-5 border border-white/[0.06]">
                <h3 class="font-medium mb-2">About:Blank</h3>
                <p class="text-text-secondary text-sm mb-3">Opens Lunar in a blank tab to hide from history</p>
                <input
                  type="text"
                  data-input="aboutBlankUrl"
                  placeholder="Redirect URL (e.g. https://classroom.google.com)"
                  class="w-full bg-background/80 border border-white/[0.06] rounded-lg px-4 py-2.5 text-sm mb-3 focus:outline-none focus:border-[#6366f1]/40"
                />
                <button data-about-blank class="bg-[#6366f1]/15 hover:bg-[#6366f1]/25 border border-[#6366f1]/30 text-sm px-4 py-2 rounded-lg flex items-center gap-2">
                  <i data-lucide="external-link" class="w-4 h-4"></i>Open in About:Blank
                </button>
              </div>

              <div class="bg-background-overlay/60 rounded-xl p-5 border border-white/[0.06]" data-cloak-container>
                <div class="flex items-center justify-between mb-4">
                  <div>
                    <h3 class="font-medium">Tab Cloak</h3>
                    <p class="text-text-secondary text-sm">Change tab title and icon</p>
                  </div>
                  <div class="toggle" data-toggle="cloak"></div>
                </div>
                
                <div data-cloak-inputs class="pt-4 border-t border-white/[0.06] space-y-3">
                  <div class="flex gap-2">
                    <button data-cloak-preset="google" data-preset-title="Google" data-preset-favicon="/a/images/co/go.ico" class="cloak-preset flex-1 flex items-center justify-center gap-2 bg-background/60 hover:bg-background/80 border border-white/[0.06] rounded-lg px-3 py-2 text-sm">
                      <img src="/a/images/co/go.ico" class="w-4 h-4" alt="" />Google
                    </button>
                    <button data-cloak-preset="drive" data-preset-title="Google Drive" data-preset-favicon="/a/images/co/drei.png" class="cloak-preset flex-1 flex items-center justify-center gap-2 bg-background/60 hover:bg-background/80 border border-white/[0.06] rounded-lg px-3 py-2 text-sm">
                      <img src="/a/images/co/drei.png" class="w-4 h-4" alt="" />Drive
                    </button>
                    <button data-cloak-preset="classroom" data-preset-title="Home" data-preset-favicon="/a/images/co/class.png" class="cloak-preset flex-1 flex items-center justify-center gap-2 bg-background/60 hover:bg-background/80 border border-white/[0.06] rounded-lg px-3 py-2 text-sm">
                      <img src="/a/images/co/class.png" class="w-4 h-4" alt="" />Classroom
                    </button>
                  </div>
                  <input type="text" data-input="cloakTitle" placeholder="Tab title" disabled class="cloak-input w-full bg-background/80 border border-white/[0.06] rounded-lg px-4 py-2.5 text-sm focus:outline-none focus:border-[#6366f1]/40 disabled:opacity-50" />
                  <input type="text" data-input="cloakFavicon" placeholder="Favicon URL" disabled class="cloak-input w-full bg-background/80 border border-white/[0.06] rounded-lg px-4 py-2.5 text-sm focus:outline-none focus:border-[#6366f1]/40 disabled:opacity-50" />
                </div>
              </div>

              <div class="bg-background-overlay/60 rounded-xl p-5 border border-white/[0.06] flex items-center justify-between">
                <div>
                  <h3 class="font-medium">Tab Switch Cloak</h3>
                  <p class="text-text-secondary text-sm">Auto-cloak when you switch tabs</p>
                </div>
                <div class="toggle" data-toggle="tabSwitchCloak"></div>
              </div>

              <div class="bg-background-overlay/60 rounded-xl p-5 border border-white/[0.06] flex items-center justify-between">
                <div>
                  <h3 class="font-medium">Anti-close</h3>
                  <p class="text-text-secondary text-sm">Confirm before closing the tab</p>
                </div>
                <div class="toggle" data-toggle="beforeUnload"></div>
              </div>

              <div class="bg-background-overlay/60 rounded-xl p-5 border border-white/[0.06]">
                <h3 class="font-medium mb-2">Panic Key</h3>
                <p class="text-text-secondary text-sm mb-3">Quickly redirect with a keybind</p>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                  <input type="text" data-input="panicLoc" placeholder="URL to redirect to" class="w-full bg-background/80 border border-white/[0.06] rounded-lg px-4 py-2.5 text-sm focus:outline-none focus:border-[#6366f1]/40" />
                  <input type="text" data-input="panicKey" placeholder="Click to set keybind" readonly class="w-full bg-background/80 border border-white/[0.06] rounded-lg px-4 py-2.5 text-sm cursor-pointer focus:outline-none focus:border-[#6366f1]/40" />
                </div>
              </div>
            </div>
          </section>

          <section id="browsing" data-section="browsing">
            <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
              <i data-lucide="globe" class="w-5 h-5 text-pink-400"></i>
              Browsing
            </h2>

            <div class="space-y-3">
              <div class="bg-background-overlay/60 rounded-xl p-5 border border-white/[0.06]">
                <h3 class="font-medium mb-3">Proxy Backend</h3>
                <div class="grid grid-cols-2 gap-3">
                  <button data-proxy="scramjet" class="proxy-button bg-background/60 hover:bg-[#6366f1]/10 border border-white/[0.06] hover:border-[#6366f1]/30 rounded-lg p-4 text-left relative">
                    <div class="font-medium text-sm">Scramjet</div>
                    <div class="text-text-secondary text-xs">Faster, some sites may break</div>
                    <div class="proxy-check absolute top-2 right-2 hidden">
                      <i data-lucide="check" class="w-4 h-4 text-[#6366f1]"></i>
                    </div>
                  </button>
                  <button data-proxy="ultraviolet" class="proxy-button bg-background/60 hover:bg-pink-400/10 border border-white/[0.06] hover:border-pink-400/30 rounded-lg p-4 text-left relative">
                    <div class="font-medium text-sm">Ultraviolet</div>
                    <div class="text-text-secondary text-xs">More stable, slower</div>
                    <div class="proxy-check absolute top-2 right-2 hidden">
                      <i data-lucide="check" class="w-4 h-4 text-pink-400"></i>
                    </div>
                  </button>
                </div>
              </div>

              <div class="bg-background-overlay/60 rounded-xl p-5 border border-white/[0.06]">
                <h3 class="font-medium mb-3">Search Engine</h3>
                <div class="grid grid-cols-4 gap-2 mb-4">
                  <button data-engine="https://duckduckgo.com/?q=" class="engine-button bg-background/60 hover:bg-[#6366f1]/10 border border-white/[0.06] rounded-lg py-2.5 text-xs relative">
                    DuckDuckGo
                    <div class="engine-check absolute -top-1 -right-1 hidden"><i data-lucide="check-circle" class="w-3.5 h-3.5 text-[#6366f1]"></i></div>
                  </button>
                  <button data-engine="https://www.google.com/search?q=" class="engine-button bg-background/60 hover:bg-[#6366f1]/10 border border-white/[0.06] rounded-lg py-2.5 text-xs relative">
                    Google
                    <div class="engine-check absolute -top-1 -right-1 hidden"><i data-lucide="check-circle" class="w-3.5 h-3.5 text-[#6366f1]"></i></div>
                  </button>
                  <button data-engine="https://www.bing.com/search?q=" class="engine-button bg-background/60 hover:bg-[#6366f1]/10 border border-white/[0.06] rounded-lg py-2.5 text-xs relative">
                    Bing
                    <div class="engine-check absolute -top-1 -right-1 hidden"><i data-lucide="check-circle" class="w-3.5 h-3.5 text-[#6366f1]"></i></div>
                  </button>
                  <button data-engine="https://search.brave.com/search?q=" class="engine-button bg-background/60 hover:bg-[#6366f1]/10 border border-white/[0.06] rounded-lg py-2.5 text-xs relative">
                    Brave
                    <div class="engine-check absolute -top-1 -right-1 hidden"><i data-lucide="check-circle" class="w-3.5 h-3.5 text-[#6366f1]"></i></div>
                  </button>
                </div>
                <input type="text" data-input="engine" placeholder="Custom search URL (ends with ?q= or &q=)" class="w-full bg-background/80 border border-white/[0.06] rounded-lg px-4 py-2.5 text-sm focus:outline-none focus:border-[#6366f1]/40" />
              </div>

              <div class="bg-background-overlay/60 rounded-xl p-5 border border-white/[0.06] flex items-center justify-between">
                <div>
                  <h3 class="font-medium">Ad Block (experimental)</h3>
                  <p class="text-text-secondary text-sm">Block ads and trackers while browsing</p>
                </div>
                <div class="toggle" data-toggle="adBlock"></div>
              </div>
            </div>
          </section>

          <section id="advanced" data-section="advanced">
            <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
              <i data-lucide="wrench" class="w-5 h-5 text-amber-400"></i>
              Advanced
            </h2>

            <div class="space-y-3">
              <div class="bg-background-overlay/60 rounded-xl p-5 border border-white/[0.06]">
                <h3 class="font-medium mb-2">Wisp Server</h3>
                <p class="text-text-secondary text-sm mb-3">Change the websocket server URL</p>
                <input type="text" data-input="wispUrl" placeholder="ws://localhost:3000/wisp/" class="w-full bg-background/80 border border-white/[0.06] rounded-lg px-4 py-2.5 text-sm focus:outline-none focus:border-[#6366f1]/40" />
              </div>

              <div class="bg-background-overlay/60 rounded-xl p-5 border border-red-500/20">
                <h3 class="font-medium mb-2 text-amber-400 flex items-center gap-2">
                  <i data-lucide="alert-triangle" class="w-4 h-4"></i>
                  Clear All Data
                </h3>
                <p class="text-text-secondary text-sm mb-3">This action cannot be undone</p>
                <button data-reset="reset" class="bg-red-500/10 hover:bg-red-500/20 border border-red-500/30 text-red-400 text-sm px-4 py-2 rounded-lg">
                  Clear All Data
                </button>
              </div>
            </div>
          </section>

          <section id="about" data-section="about">
            <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
              <i data-lucide="info" class="w-5 h-5 text-[#6366f1]"></i>
              About
            </h2>

            <div class="bg-background-overlay/60 rounded-xl p-5 border border-white/[0.06]">
              <div class="flex items-center gap-4 mb-4">
                <div class="w-12 h-12 rounded-xl bg-[#6366f1]/20 flex items-center justify-center">
                  <i data-lucide="moon" class="w-6 h-6 text-[#6366f1]"></i>
                </div>
                <div>
                  <h3 class="font-semibold text-lg">Lunar v2</h3>
                  <p class="text-text-secondary text-sm">v2.0.0</p>
                </div>
              </div>
              
              <div class="text-sm space-y-2 mb-4">
                <div class="flex justify-between"><span class="text-text-secondary">Developed by</span><span>Bearcattt</span></div>
                <div class="flex justify-between"><span class="text-text-secondary">Built with</span><span>Astro, TypeScript, Tailwind</span></div>
              </div>

              <div class="flex gap-2">
                <a href="https://github.com/lunar-proxy/lunar-v2" target="_blank" class="flex items-center gap-2 bg-background/60 hover:bg-background/80 border border-white/[0.06] rounded-lg px-3 py-2 text-sm">
                  <i data-lucide="github" class="w-4 h-4"></i>GitHub
                </a>
                <a href="https://discord.gg/lunar" target="_blank" class="flex items-center gap-2 bg-background/60 hover:bg-background/80 border border-white/[0.06] rounded-lg px-3 py-2 text-sm">
                  <i data-lucide="message-circle" class="w-4 h-4"></i>Discord
                </a>
              </div>
            </div>
          </section>
        </main>
      </div>

      <div data-notification class="fixed bottom-6 right-6 hidden toast">
        <div class="bg-[#10b981]/20 border border-[#10b981]/40 rounded-lg px-4 py-3 flex items-center gap-2 text-sm">
          <i data-lucide="check" class="w-4 h-4 text-[#10b981]"></i>
          <span>Settings saved</span>
        </div>
      </div>
    </div>

    <ImportLucide />
    <script>
      import('../utils/st').then(({ SettingsManager }) => SettingsManager.init());
      import('../utils/config').then(({ default: ConfigAPI }) => {
        document.querySelector('[data-about-blank]')?.addEventListener('click', async () => {
          const url = (await ConfigAPI.get('aboutBlankUrl') as string) || 'https://classroom.google.com';
          const win = window.open('about:blank', '_blank');
          if (win) {
            win.location = 'about:blank';
            window.location.href = url;
          }
        });
      });
    </script>
  </body>
</html>
